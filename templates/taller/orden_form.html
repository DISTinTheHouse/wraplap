{% extends "taller/base.html" %}

{% block title %}The Wrap Lab | {{ titulo|default:"Nueva orden" }}{% endblock %}

{% block content %}
<div class="flex min-h-[60vh] flex-col items-center justify-center py-12">
  <div class="relative w-full max-w-3xl">
    <!-- Glow effects -->
    <div class="absolute -left-4 -top-4 h-64 w-64 rounded-full bg-brand-blue/10 blur-3xl"></div>
    <div class="absolute -bottom-4 -right-4 h-64 w-64 rounded-full bg-cyan-500/10 blur-3xl"></div>

    <!-- Card -->
    <div class="relative rounded-3xl border border-zinc-800 bg-zinc-900/50 p-8 shadow-2xl backdrop-blur-xl sm:p-10">

      <!-- Header -->
      <div class="mb-8 flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
        <div>
          <h1 class="text-3xl font-bold tracking-tight text-white">{{ titulo|default:"Nueva orden" }}</h1>
          <p class="mt-2 text-zinc-400">
            {% if orden %}
            Editando folio: <span class="font-mono text-white">{{ orden.folio }}</span>
            {% else %}
            Ingresa los detalles para generar un nuevo servicio.
            {% endif %}
          </p>
        </div>
        <a class="group flex items-center gap-2 rounded-xl border border-zinc-700 bg-zinc-800 px-4 py-2 text-sm font-medium text-zinc-300 transition hover:bg-zinc-700 hover:text-white"
          href="{% url 'dashboard' %}">
          <svg class="h-4 w-4 transition group-hover:-translate-x-0.5" fill="none" viewBox="0 0 24 24"
            stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Volver
        </a>
      </div>

      <form class="space-y-6" method="post">
        {% csrf_token %}

        {% if form.non_field_errors %}
        <div class="rounded-xl border border-red-500/20 bg-red-500/10 px-4 py-3 text-sm text-red-200">
          {{ form.non_field_errors }}
        </div>
        {% endif %}

        <div class="grid gap-6 sm:grid-cols-2">
          {% for field in form %}
          {% if field.name == 'testigos' %}
          <div class="space-y-3 sm:col-span-2">
            <label class="block text-sm font-medium text-zinc-300">
              {{ field.label }}
            </label>
            <div class="grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4">
              {% for checkbox in field %}
              <label
                class="group flex cursor-pointer items-center gap-3 rounded-xl border border-zinc-800 bg-zinc-950/50 p-3 transition hover:border-zinc-700 hover:bg-zinc-900 has-[:checked]:border-brand-blue has-[:checked]:bg-brand-blue/10">
                <div class="relative flex h-5 w-5 items-center justify-center">
                  <input type="checkbox" name="{{ checkbox.data.name }}" value="{{ checkbox.data.value }}" {% if checkbox.data.selected %}checked{% endif %}
                    class="h-4 w-4 rounded border-zinc-700 bg-zinc-900 text-brand-blue focus:ring-brand-blue focus:ring-offset-zinc-950">
                </div>
                <div class="flex items-center gap-2">
                  {% if checkbox.data.value == 'check_engine' %}
                  <svg class="h-5 w-5 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5H6.5C5.84 5 5.28 5.42 5.08 6.01L3 12V20C3 20.55 3.45 21 4 21H5C5.55 21 6 20.55 6 20V19H18V20C18 20.55 18.45 21 19 21H20C20.55 21 21 20.55 21 20V12L18.92 6.01ZM6.5 16C5.67 16 5 15.33 5 14.5C5 13.67 5.67 13 6.5 13C7.33 13 8 13.67 8 14.5C8 15.33 7.33 16 6.5 16ZM17.5 16C16.67 16 16 15.33 16 14.5C16 13.67 16.67 13 17.5 13C18.33 13 19 13.67 19 14.5C19 15.33 18.33 16 17.5 16ZM5 11L6.5 6.5H17.5L19 11H5Z" />
                  </svg>
                  {% elif checkbox.data.value == 'battery' %}
                  <svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M16 20H8V6H16V20ZM16.67 4H15V2H9V4H7.33C6.6 4 6 4.6 6 5.33V20.67C6 21.4 6.6 22 7.33 22H16.67C17.4 22 18 21.4 18 20.67V5.33C18 4.6 17.4 4 16.67 4ZM11 16H13V13H16V11H13V8H11V11H8V13H11V16Z" />
                  </svg>
                  {% elif checkbox.data.value == 'oil' %}
                  <svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M19.7 15.4L15.3 4.1C15 3.3 14 3 13.4 3.7L11.5 6.2C11 5.4 10.1 5 9 5C6.8 5 5 6.8 5 9V17C5 19.2 6.8 21 9 21C11.2 21 13 19.2 13 17V16.3L20.2 16.8C20.8 16.9 21.2 16.2 20.8 15.7L19.7 15.4ZM11 17C11 18.1 10.1 19 9 19C7.9 19 7 18.1 7 17V9C7 7.9 7.9 7 9 7C10.1 7 11 7.9 11 9V17ZM17.2 14.9L13.8 14.6L16.2 8.3L17.2 14.9Z" />
                  </svg>
                  {% elif checkbox.data.value == 'temp' %}
                  <svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M15 13V5C15 3.34 13.66 2 12 2C10.34 2 9 3.34 9 5V13C6.79 14.66 6.34 17.79 8 20C9.66 22.21 12.79 22.66 15 21C15.88 20.34 16.55 19.46 16.88 18.44C17.58 16.29 16.8 13.91 15 13ZM12 4C12.55 4 13 4.45 13 5V8H11V5C11 4.45 11.45 4 12 4Z" />
                  </svg>
                  {% elif checkbox.data.value == 'abs' %}
                  <svg class="h-5 w-5 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2zm0-2h2V7h-2z" />
                    <text x="12" y="14" font-size="6" text-anchor="middle" fill="currentColor" font-weight="bold"
                      font-family="sans-serif">ABS</text>
                  </svg>
                  {% elif checkbox.data.value == 'brake' %}
                  <svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2zm0-2h2V7h-2z" />
                    <text x="12" y="14" font-size="5" text-anchor="middle" fill="currentColor" font-weight="bold"
                      font-family="sans-serif">BRAKE</text>
                  </svg>
                  {% elif checkbox.data.value == 'airbag' %}
                  <svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 13c-2.67 0-8 1.34-8 4v1h16v-1c0-2.66-5.33-4-8-4zm0-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                  </svg>
                  {% elif checkbox.data.value == 'tire' %}
                  <svg class="h-5 w-5 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v2h-2zm0-10h2v6h-2z" />
                    <path d="M17 5v14h2V5h-2zm-12 0v14h2V5H5z" />
                  </svg>
                  {% elif checkbox.data.value == 'stability' %}
                  <svg class="h-5 w-5 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M5 16h14v2H5zm0-4h14v2H5zm0-4h14v2H5z" />
                  </svg>
                  {% elif checkbox.data.value == 'bulb' %}
                  <svg class="h-5 w-5 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6C7.93 12.07 7 10.64 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.93 3.07-2.15 4.1z" />
                  </svg>
                  {% elif checkbox.data.value == 'gas' %}
                  <svg class="h-5 w-5 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M19.77 7.23l.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33a2.5 2.5 0 0 0 2.5 2.5c.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77zM12 10H6V5h6v5zm6 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
                  </svg>
                  {% elif checkbox.data.value == 'service' %}
                  <svg class="h-5 w-5 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z" />
                  </svg>
                  {% endif %}
                  <span class="text-xs font-medium text-zinc-400 group-has-[:checked]:text-white select-none">{{ checkbox.choice_label }}</span>
                </div>
              </label>
              {% endfor %}
            </div>
            {% if field.errors %}
            <div class="text-sm text-red-400">{{ field.errors }}</div>
            {% endif %}
            {% if field.help_text %}
            <p class="text-xs text-zinc-500">{{ field.help_text }}</p>
            {% endif %}
          </div>
          {% else %}
          <div class="space-y-2 {% if field.name == 'notas' %}sm:col-span-2{% endif %}">
            <label class="block text-sm font-medium text-zinc-300" for="{{ field.id_for_label }}">
              {{ field.label }}
            </label>
            {{ field }}
            {% if field.errors %}
            <div class="text-sm text-red-400">{{ field.errors }}</div>
            {% endif %}
            {% if field.help_text %}
            <p class="text-xs text-zinc-500">{{ field.help_text }}</p>
            {% endif %}
          </div>
          {% endif %}
          {% endfor %}
        </div>

        <div class="mt-8 flex items-center justify-end border-t border-zinc-800 pt-6">
          <button
            class="w-full rounded-xl bg-white px-8 py-3 font-semibold text-zinc-950 shadow-lg transition hover:bg-zinc-200 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2 focus:ring-offset-zinc-900 sm:w-auto"
            type="submit">
            {% if orden %}Guardar Cambios{% else %}Crear Orden{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}